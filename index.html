<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>H√†nh Tr√¨nh STOP 4P</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <canvas id="fireworks-canvas"></canvas>
    <button id="back-btn" onclick="goBack()">‚Üê Quay l·∫°i</button>
    <div id="stage-0" class="stage active" style="display: flex; justify-content: center; align-items: center;">
    
    <div id="welcome-modal" style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%;">
        
        <h2 style="color: #D81B60; margin-bottom: 10px;">Ch√†o ch·ªã,</h2>
        
        <div id="step-phone">
            <p style="color: #666; margin-bottom: 20px;">Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ h·ªá th·ªëng ghi nh·ªõ ch·ªã nh√©.</p>
            <input type="tel" id="input-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i..." 
                   style="width: 100%; padding: 15px; border: 2px solid #FFCDD2; border-radius: 30px; margin-bottom: 20px; font-size: 16px; outline: none; text-align: center; box-sizing: border-box;">
            <button onclick="checkPhone()" 
                    style="background: #E91E63; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%;">
                Ti·∫øp t·ª•c
            </button>
        </div>

        <div id="step-name" style="display: none;">
            <p style="color: #666; margin-bottom: 20px;">Ch·ªã l√† th√†nh vi√™n m·ªõi. Ch·ªã t√™n l√† g√¨ ·∫°?</p>
            <input type="text" id="input-name" placeholder="T√™n c·ªßa ch·ªã l√†..." 
                   style="width: 100%; padding: 15px; border: 2px solid #FFCDD2; border-radius: 30px; margin-bottom: 20px; font-size: 16px; outline: none; text-align: center; box-sizing: border-box;">
            <button onclick="registerAndStart()" 
                    style="background: #E91E63; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%;">
                B·∫Øt ƒë·∫ßu h√†nh tr√¨nh
            </button>
        </div>

        <div id="step-welcome-back" style="display: none;">
            <p id="welcome-message" style="color: #666; margin-bottom: 20px; font-size: 18px;">Ch√†o m·ª´ng ch·ªã quay l·∫°i!</p>
            <button onclick="startGameDirectly()" 
                    style="background: #4CAF50; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%;">
                V√†o ch∆°i th√¥i
             </button>
             <button onclick="showMyHistory()" 
                    style="
                        background-color: #00897b; /* M√†u xanh ng·ªçc ƒë·∫≠m ƒë√† h∆°n */
                        color: white;              /* Ch·ªØ tr·∫Øng */
                        border: none;              /* üî• X√ìA C√ÅI VI·ªÄN ƒêEN X·∫§U X√ç */
                        padding: 12px 24px;        /* N√∫t to v√† d√†y h∆°n */
                        border-radius: 50px;       /* Bo tr√≤n m·ªÅm m·∫°i gi·ªëng n√∫t tr√™n */
                        font-size: 16px;           /* Ch·ªØ to r√µ */
                        font-weight: bold;         /* Ch·ªØ ƒë·∫≠m */
                        cursor: pointer;           /* Con tr·ªè chu·ªôt bi·∫øn th√†nh b√†n tay */
                        margin-top: 15px;          /* C√°ch n√∫t tr√™n ra m·ªôt ch√∫t */
                        width: 100%;               /* D√†i b·∫±ng n√∫t tr√™n */
                        box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* ƒê·ªï b√≥ng nh·∫π cho n·ªïi */
                        transition: all 0.3s ease; /* Hi·ªáu ·ª©ng m∆∞·ª£t m√† */"
                        onmouseover="this.style.backgroundColor='#00796b'; this.style.transform='scale(1.02)'"
                        onmouseout="this.style.backgroundColor='#00897b'; this.style.transform='scale(1)'"
>
                            üìñ Xem l·∫°i Nh·∫≠t K√Ω c·ªßa m√¨nh
                        </button>
            </div>

        </div>
    </div>

    <div id="stage-emotion-check" class="stage" style="display: none;">
        <div class="welcome-container" style="max-width: 600px;">
            <h2 style="color: #00796B;">Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu, ch·ªã c·∫£m th·∫•y th·∫ø n√†o?</h2>
            <p style="color: #666;">H√£y k√©o thanh tr∆∞·ª£t ƒë·ªÉ ch·ªçn m·ª©c ƒë·ªô ph√π h·ª£p nh·∫•t nh√©.</p>

            <div id="emotion-display-area" style="margin: 30px 0; transition: all 0.3s;">
                <div id="current-emoji" style="font-size: 80px; margin-bottom: 10px;">üòê</div>
                <div id="current-status" style="font-size: 24px; font-weight: bold; color: #F57F17;">5 - B√¨nh th∆∞·ªùng (·ªîn)</div>
            </div>

            <div class="slider-container" style="position: relative; padding: 0 20px; margin-bottom: 40px;">
                <input type="range" min="1" max="10" value="5" id="emotion-range" 
                       style="width: 100%; height: 15px; border-radius: 10px; background: linear-gradient(to right, #1a237e, #4a148c, #b71c1c, #f57f17, #fdd835, #66bb6a, #00c853); outline: none; -webkit-appearance: none; cursor: pointer;"
                       oninput="updateEmotionDisplay()">
                
                <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #888; font-size: 14px;">
                    <span>1 (Tuy·ªát v·ªçng)</span>
                    <span>10 (R·∫•t tuy·ªát v·ªùi)</span>
                </div>
            </div>

            <button class="btn-start" onclick="submitInitialEmotion()">X√°c nh·∫≠n & Ti·∫øp t·ª•c</button>
        </div>
    </div>
    
    <div id="stage-1" class="stage">
        <div id="greeting-text"></div> 
        <div id="monkey-metaphor">Nh·ªØng suy nghƒ© trong ƒë·∫ßu nh∆∞ nh·ªØng ch√∫ kh·ªâ ƒëang ch·∫°y nh·∫£y lung tung...</div>
        <div id="top-message-area"></div>
        <div class="garden-scene" id="scene-s1"></div>

        <div id="countdown-display"></div>
        <div id="controls-container">
            <button id="stop-btn" onmousedown="startProcess(event)" onmouseup="cancelProcess()" onmouseleave="cancelProcess()" ontouchstart="startProcess(event)" ontouchend="cancelProcess()">üîî</button>
            <div id="guide-text-s1">Nh·∫•n gi·ªØ chu√¥ng ƒë·ªÉ ra l·ªánh<br>"D·ª™NG L·∫†I"</div>
            <div id="success-panel">
                <div class="fountain">‚õ≤</div>
                <div class="congrats-text">
                    üéâ Ch√∫c m·ª´ng ch·ªã ƒë√£ ho√†n th√†nh tr√≤ ch∆°i ƒë·∫ßu ti√™n.<br> C√πng ti·∫øp t·ª•c <b>H√ÄNH TR√åNH B√åNH AN</b> ch·ªã nh√©.
                </div>
                <button class="next-btn" onclick="switchStage(2)">TI·∫æP T·ª§C</button>
            </div>
        </div>
    </div>

    <div id="stage-2" class="stage">
        <div id="instruction-dragon">Nh·∫•n gi·ªØ ƒë·ªÉ H√çT V√ÄO...</div>
        <div class="game-scene">
            <div class="dragon-container">
                <div class="fire-stream" id="fire"></div>
                <div class="head">
                    <div class="eye"></div>
                    <div class="cheek"></div>
                    <div class="mouth smile" id="mouth"></div>
                </div>
                <div class="body"></div>
                <div class="belly" id="belly"></div>
                <div class="arm left"></div>
                <div class="arm right"></div>
            </div>
            <div class="pinwheel-wrapper">
                <div class="stick"></div>
                <div class="pinwheel-container" id="pinwheel">
                    <div class="blade b1"></div><div class="blade b2"></div>
                    <div class="blade b3"></div><div class="blade b4"></div>
                    <div class="center-dot"></div>
                </div>
            </div>
        </div>
        <button id="interaction-area">Nh·∫•n gi·ªØ</button>
        <button id="next-btn-dragon" onclick="switchStage(3)">Ti·∫øp t·ª•c h√†nh tr√¨nh ‚Üí</button>
    </div>

    <div id="stage-3" class="stage">
        <div id="guide-text-body">H√£y b·∫Øt ƒë·∫ßu r√† so√°t c∆° th·ªÉ m·∫π v√† b√©...</div>
        <div id="meditation-container">
            </div>
        <div id="action-buttons-body">
            <button id="continue-btn-body" onclick="switchStage(4)">Ti·∫øp t·ª•c h√†nh tr√¨nh ‚Üí</button>
            <button id="restart-btn-body" onclick="initBodyScan()">‚Ü∫ Th·ª±c h√†nh l·∫°i</button>
        </div>
    </div>

    <div id="stage-4" class="stage">
        <div id="selection-screen">
            <h2>C·∫£m x√∫c hi·ªán t·∫°i c·ªßa ch·ªã gi·ªëng b√© Capybara n√†o nh·∫•t?</h2>
            <p class="subtitle">G·ªçi t√™n c·∫£m x√∫c gi√∫p gi·∫£m ƒëi s·ª± m∆° h·ªì trong t√¢m tr√≠...</p>
            <div class="emotion-grid">
                <div class="capy-card" onclick="selectEmotion('Vui v·∫ª')"><img src="vui.jpg" alt="Vui v·∫ª" class="capy-img"></div>
                <div class="capy-card" onclick="selectEmotion('Bu·ªìn')"><img src="bu·ªìn.jpg" alt="Bu·ªìn" class="capy-img"></div>
                <div class="capy-card" onclick="selectEmotion('Lo l·∫Øng')"><img src="kh√≥c.jpg" alt="Lo l·∫Øng" class="capy-img"></div>
                <div class="capy-card" onclick="selectEmotion('Kh√≥ ch·ªãu')"><img src="t·ª©c.jpg" alt="Kh√≥ ch·ªãu" class="capy-img"></div>
                <div class="capy-card" onclick="selectEmotion('Ho·∫£ng h·ªët')"><img src="ho·∫£ng h·ªët.jpg" alt="Ho·∫£ng h·ªët" class="capy-img"></div>
                <div class="capy-card" onclick="selectEmotion('M·ªát m·ªèi')"><img src="kh√≥ ch·ªãu.jpg" alt="M·ªát m·ªèi" class="capy-img"></div>
            </div>
        </div>
        <div id="feedback-screen">
            <div class="feedback-text">"C·∫£m ∆°n ch·ªã ƒë√£ d≈©ng c·∫£m g·ªçi t√™n c·∫£m x√∫c.<br>B√¢y gi·ªù, m√¨nh c√πng tr√∫t b·ªè g√°nh n·∫∑ng nh√©."</div>
            <button class="btn-next-capy" onclick="switchStage(5)">Ti·∫øp t·ª•c h√†nh tr√¨nh ‚Üí</button>
        </div>
    </div>

    <div id="stage-5" class="stage">
        <div class="sun"></div>
        <div id="hint-text-cloud">Ch·∫°m v√†o b·∫ßu tr·ªùi ƒë·ªÉ vi·∫øt ti·∫øp...</div>
        <div id="input-container-cloud">
            <h2>Quan S√°t Suy Nghƒ©</h2>
            <p>Suy nghƒ© n√†o ƒëang l√†m phi·ªÅn ch·ªã?<br>H√£y vi·∫øt n√≥ ra v√† ƒë·ªÉ gi√≥ cu·ªën ƒëi.</p>
            <input type="text" id="thoughtInput" placeholder="V√≠ d·ª•: lo l·∫Øng..." autocomplete="off">
            <button id="sendBtn" class="btn-primary" onclick="createCloud(event)">H√≠t v√†o v√† d√°n l√™n ƒë√°m m√¢y</button>
            <button class="btn-secondary" onclick="switchStage(6)">Ti·∫øp t·ª•c h√†nh tr√¨nh ‚Üí</button>
        </div>
    </div>

    <div id="stage-6" class="stage">
        <div id="intro-screen-jar">
            <div class="instruction-text">ƒê·ªÉ k·∫øt th√∫c b√†i th·ª±c h√†nh, ch·ªã h√£y d√†nh m·ªôt kho·∫£nh kh·∫Øc k·∫øt n·ªëi v·ªõi em b√© ho·∫∑c v·ªõi ch√≠nh m√¨nh.<br><br>H√£y ƒë·∫∑t 2 tay l√™n ng·ª±c v√† th·∫ßm n√≥i:</div>
            <div class="mantra">"M·∫π con m√¨nh c√πng B√¨nh An nh√©"</div>
            <button class="btn" id="connect-btn-s6" onclick="goToWrite()">ƒê√£ k·∫øt n·ªëi</button>
        </div>
        <div id="write-screen-jar">
            <div style="margin-bottom: 20px; font-size: 18px; color: #880e4f;">Vi·∫øt l·ªùi nh·∫Øn y√™u th∆∞∆°ng l√™n tr√°i tim n√†y:</div>
            <div class="heart-note"><textarea id="note-input" placeholder="Nh·∫Øn nh·ªß ƒëi·ªÅu g√¨ ƒë√≥..."></textarea></div>
            <button class="btn" onclick="saveToJar()">C·∫•t v√†o H≈© B√¨nh An</button>
        </div>
        <div id="jar-screen-final">
            <div class="jar" id="jar">
                <div class="small-heart" style="bottom: 10px; left: 30px; transform: rotate(-30deg) scale(0.8); background:#f48fb1"></div>
                <div class="small-heart" style="bottom: 20px; right: 40px; transform: rotate(-60deg) scale(0.7); background:#f06292"></div>
                <div class="small-heart" style="bottom: 40px; left: 60px; transform: rotate(-15deg) scale(0.6); background:#f8bbd0"></div>
            </div>
            <div id="final-message">Ch√∫c hai m·∫π con lu√¥n B√¨nh An! ‚ù§Ô∏è</div>
            <button id="continue-btn-jar" class="btn" onclick="switchStage(7)">Ti·∫øp t·ª•c h√†nh tr√¨nh ‚Üí</button>
        </div>
    </div>

    <div id="stage-7" class="stage">
        <div class="welcome-container">
            <h2 style="color: #00796B;">Sau h√†nh tr√¨nh, ch·ªã c·∫£m th·∫•y th·∫ø n√†o?</h2>
            <p style="color: #666;">H√£y k√©o thanh tr∆∞·ª£t ƒë·ªÉ ch·ªçn m·ª©c ƒë·ªô ph√π h·ª£p nh·∫•t nh√©.</p>
            
            <div class="emotion-display-area" style="margin: 30px 0;">
                <div id="final-emoji" style="font-size: 80px;">üôÇ</div>
                <div id="final-status" style="font-size: 24px; font-weight: bold; color: #F57F17;">6 - T∆∞∆°ng ƒë·ªëi t·ªët</div>
            </div>

            <div class="slider-container" style="padding: 0 10px;">
                <input type="range" min="1" max="10" value="6" id="final-range" 
       oninput="updateFinalEmotionDisplay()" 
       style="background: linear-gradient(to right, #1a237e, #4a148c, #b71c1c, #f57f17, #fdd835, #66bb6a, #00c853);">
                
                <div style="display: flex; justify-content: space-between; color: #888; font-size: 14px;">
                    <span>1 (Tuy·ªát v·ªçng)</span><span>10 (R·∫•t tuy·ªát v·ªùi)</span>
                </div>
            </div>

            <button class="btn btn-start" onclick="finishJourney()" style="margin-top: 20px;">Ho√†n th√†nh</button>
        </div>
    </div>

    <div id="admin-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 9999; overflow-y: auto;">
    <div style="max-width: 1000px; margin: 50px auto; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #d81b60; padding-bottom: 10px;">
            <h2 style="color: #d81b60; margin: 0;">üîê QU·∫¢N TR·ªä VI√äN</h2>
            <button onclick="closeAdmin()" style="background: #333; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 5px;">Tho√°t X</button>
        </div>

        <div style="margin-top: 20px;">
            <button onclick="fetchHistory()" style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">üîÑ L√†m m·ªõi d·ªØ li·ªáu</button>
        </div>

        <table style="width: 100%; border-collapse: collapse; margin-top: 20px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <thead>
                <tr style="background: #f8bbd0; color: #880e4f;">
                    <th style="padding: 12px; border: 1px solid #ddd;">Ng√†y gi·ªù</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">T√™n</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">SƒêT</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">Mood ƒê·∫ßu</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">Capybara</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">ƒê√°m m√¢y</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">L·ªùi nh·∫Øn</th>
                    <th style="padding: 12px; border: 1px solid #ddd;">Mood Cu·ªëi</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="admin-table-body">
                </tbody>
        </table>
    </div>
</div>

<div id="my-history-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; overflow-y: auto;">
    <div style="max-width: 600px; margin: 50px auto; background: white; padding: 25px; border-radius: 15px; text-align: center;">
        <h2 style="color: #009688; margin-bottom: 20px;">üìñ Nh·∫≠t K√Ω C·∫£m X√∫c</h2>
        
        <div id="my-history-content" style="max-height: 400px; overflow-y: auto; text-align: left;">
            </div>

        <button onclick="closeMyHistory()" style="margin-top: 20px; background: #555; padding: 10px 30px;">ƒê√≥ng l·∫°i</button>
    </div>
</div>

    <script src="script.js"></script>
</body>
</html>